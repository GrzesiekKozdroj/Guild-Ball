<!doctype html>
<html>

<head>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=9">
        <title>txt</title>
        <style>
          body{ background-color: ivory; }
#canvas{border:1px solid red;}
#r1disp, #r2disp { font: inherit; border:0;  background-color: ivory; }
#r1, #r2 {  font-size: 8px; width: 200px; }
        </style>
      </head>
</head>
<body>
 
  <p>Finds the intersection of two circles. Click and drag either of the points, enter the radii in the text boxes.</p>

<table border="0">
<tr>
    <td> 
       <label for="amount">r1:</label>
    <input type="text" id="r1disp" size="5" value="100" readonly />
    </td>
    <td> <div id="r1"></div>
    </td>
</tr>
  <tr>
    <td> 
      <label for="amount">r2:</label>
      <input type="text" id="r2disp" size="5" value="50" readonly />
    </td>
    <td><div id="r2"></div></td>
  </tr>
</table>
<canvas id="canvas" width=300 height=300></canvas>

<script>
// Find the points of intersection of two circles

// Global variables 
var    x1 = 100; // center of first circle
var    y1 = 150;
var    d1 = 100; // radius

var    x2 = 230; // center of second circle
var    y2 = 150;
var    d2 = 50;  // radius

// calculate the intersections 
function calc() {
    if(d1 < 0 || d2 < 0) return;
    var a = d2;
    var b = d1;
    var c = Math.sqrt((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2));
    var d = (b*b+c*c-a*a)/(2*c);
    var h = Math.sqrt(b*b-d*d);
    console.log(a,b,c,d,h);
    x3 = (x2-x1)*d/c + (y2-y1)*h/c +  x1;
    y3 = (y2-y1)*d/c - (x2-x1)*h/c +  y1;
    x4 = (x2-x1)*d/c - (y2-y1)*h/c +  x1;
    y4 = (y2-y1)*d/c + (x2-x1)*h/c +  y1;
}

// first method using trig
function calctrig() {
    if(d1 < 0 || d2 < 0) return;
    var a = d2;
    var b = d1;
    var c = Math.sqrt((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2));
    var A = Math.acos((b*b+c*c-a*a)/(2*b*c));
    var theta = Math.atan2(y2-y1,x2-x1);
    console.log(a,b,c,A,theta);
    var phi1 = theta+A;
    var phi2 = theta-A;
    x3 = d1 * Math.cos(phi1) + x1;
    y3 = d1 * Math.sin(phi1) + y1;

    x4 = d1 * Math.cos(phi2) + x1;
    y4 = d1 * Math.sin(phi2) + y1; 
}

// canvas and mousedown related variables
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
var $canvas = $("#canvas");
var canvasOffset = $canvas.offset();
var offsetX = canvasOffset.left;
var offsetY = canvasOffset.top;
var scrollX = $canvas.scrollLeft();
var scrollY = $canvas.scrollTop();


// save canvas size to vars b/ they're used often
var canvasWidth = canvas.width;
var canvasHeight = canvas.height;

// list of lines created
var lines = new Array();

// list of all solutions 
var allSolutions = new Array();
// solutions round bounding rect
var refinedSols = new Array();
// ordered solutions for polygon
var polySols = new Array();

/////////// The line type

// A line defined by  a x + b y + c = 0
function Line(a,b,c) {
    this.a = a;
    this.b = b;
    this.c = c;
}

// given two points create the line
function makeLine(x0,y0,x1,y1) {
    // Line is defined by 
    // (x - x0) * ( y1 - y0) = ( y - y0) * ( x1 - x0)
    // (y1-y0)*x - (x1-x0)* y + x0*(y1-y0)+y0*(x1-x0) = 0
    return new Line( (y1-y0), (x0-x1), -x0*(y1-y0)+y0*(x1-x0));
};

Line.prototype.toString = function () {
    var s = "" + this.a + " x ";
    s += (this.b >= 0 ? "+ "+this.b : "- "+ (-this.b) );
    s += " y ";
    s += (this.c >= 0 ? "+ "+this.c : "- "+ (-this.c) );
    return s + " = 0";
};

Line.prototype.draw = function() {
  var points = new Array();
  // find the intersecetions with the boinding box
    // lhs :  a * 0 + b * y + c = 0  
    if( this.b != 0 ) {
        var y = -this.c / this.b;
        if( y >= 0 && y <= canvasHeight ) 
            points.push([0,y]);
    }
    // rhs :  a * canvasWidth + b * y + c = 0  
    if( this.b != 0 ) {
        var y = ( - this.a * canvasWidth - this.c )/ this.b;
        if( y >= 0 && y <= canvasHeight ) 
            points.push([canvasWidth,y]);
    }
    // top : a * x + b * 0 + c = 0  
    if( this.a != 0 ) {
        var x = -this.c / this.a;
        if( x > 0 && x < canvasWidth ) 
            points.push([x,0]);
    }
    // bottom : a * x + b * canvasHeight + c = 0  
    if( this.a != 0 ) {
        var x = ( - this.b * canvasHeight - this.c )/ this.a;
        if( x > 0 && x < canvasWidth ) 
            points.push([x,canvasHeight]);
    }
    if(points.length == 2) {
      ctx.moveTo(points[0][0], points[0][1]);
      ctx.lineTo(points[1][0], points[1][1]);
    }
    else
      console.log(points.toString());
}


// draw 
function draw() {
    console.log("drawlines");
    ctx.clearRect(0, 0, canvas.width, canvas.height)


    ctx.lineWidth = 5;
    ctx.beginPath();
    lines.forEach(function(line, index, array) {console.log(line.toString()); line.draw();});
       
    ctx.beginPath();
    ctx.fillStyle = "Red";
    ctx.fillRect(x1-5,y1-5,10,10);
    ctx.fillRect(x2-5,y2-5,10,10);

    ctx.stroke();

    
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.fillStyle = "black";
    if(d1>0) 
        ctx.arc(x1, y1, d1, 0, Math.PI*2, true); 
    ctx.stroke();
    ctx.beginPath();
    if(d2>0) 
        ctx.arc(x2, y2, d2, 0, Math.PI*2, true); 
    ctx.stroke();

    ctx.beginPath();
    ctx.fillStyle = "Blue";
    ctx.fillRect(x3-5,y3-5,10,10);
    ctx.fillRect(x4-5,y4-5,10,10);

    ctx.stroke();

}


function reset() {
    x1 = -10;
    y1 = -10;
    x2 = -10;
    y2 = -10;
    lines.splice(0);
}

var pointId = -1;

// Handle mouse clicks

function handleMouseUp(e) {
    pointId = -1;
}

function handleMouseDown(e) {
    e.preventDefault();

    // get the mouse position
    var x = parseInt(e.pageX - offsetX);
    var y = parseInt(e.pageY - offsetY);
    
    if((x-x1)*(x-x1)+(y-y1)*(y-y1) < 50) {
      $('#canvas').css('cursor', 'pointer');
      pointId = 1;     
    } else if((x-x2)*(x-x2)+(y-y2)*(y-y2) < 50) {
      $('#canvas').css('cursor', 'pointer');
      pointId = 2;     
    } else {
      $('#canvas').css('cursor', 'default');
      pointId = -1;     
    }
}
    
function handleMouseMove(e) {
    var x = parseInt(e.pageX - offsetX);
    var y = parseInt(e.pageY - offsetY);
    
    if(pointId == 1) {
        x1 = x;
        y1 = y;
        calc();
        draw();

    } else if(pointId == 2) {
        x2 = x;
        y2 = y;
        calc();
        draw();

    } else if((x-x1)*(x-x1)+(y-y1)*(y-y1) < 50) {
      $('#canvas').css('cursor', 'pointer');
    } else if((x-x2)*(x-x2)+(y-y2)*(y-y2) < 50) {
      $('#canvas').css('cursor', 'pointer');
    } else {
      $('#canvas').css('cursor', 'default');
    }
}

$("#canvas").mousemove(function (e) {
    handleMouseMove(e);
});

$("#canvas").mousedown(function (e) {
    handleMouseDown(e);
});

$("#canvas").mouseup(function (e) {
    handleMouseUp(e);
});

$("#d1").change(function() {
  d1 = parseInt($("#d1").val());
    calc();
    draw();
});

$("#d2").change(function() {
  d2 = parseInt($("#d2").val());
    calc();
    draw();
});

calc();
draw();

</script>

</body>
</html>